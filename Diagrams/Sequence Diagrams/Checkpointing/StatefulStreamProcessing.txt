@startuml
Title: Apache Flink Stateful Stream Processing Checkpointing

box "flink" #LightBlue
  participant Core.ss
end box

box "Checkpoint.ss" #LightGreen
  participant CheckpointCoordinator.ss
  participant MetaData.ss
  participant Hooks.ss
  participant Channel.ss
end box

box "Runtime.ss" #LightYellow
  participant JobMaster.ss
  participant ExecutionGraph.ss
  participant JobGraph.ss
  participant TaskExecutor.ss
  participant TaskManager.ss
  participant State.ss
end box

Core.ss->CheckpointCoordinator.ss: TriggerCheckpoint()
CheckpointCoordinator.ss->Hooks.ss: ExecutePreCheckpointHooks()
Hooks.ss->State.ss: AccessStateData()
Hooks.ss->MetaData.ss: CollectCheckpointMetadata()
MetaData.ss-->Hooks.ss: Metadata
Hooks.ss->Channel.ss: StartDataTransfer()
Channel.ss-->Hooks.ss: DataTransferComplete()
Hooks.ss->MetaData.ss: CompleteCheckpoint()
MetaData.ss-->Hooks.ss: Metadata
Hooks.ss->State.ss: ExecutePostCheckpointHooks()
State.ss-->Hooks.ss: Post-checkpoint Actions
CheckpointCoordinator.ss->MetaData.ss: TriggerCheckpoint()
CheckpointCoordinator.ss->Hooks.ss: NotifyCheckpointTrigger()
Hooks.ss->Channel.ss: TriggerCheckpoint()
Channel.ss-->Hooks.ss: ConfirmCheckpointTrigger()
Hooks.ss-->CheckpointCoordinator.ss: NotifyCheckpointTriggerComplete()
CheckpointCoordinator.ss->Channel.ss: StartDataTransfer()
Channel.ss->CheckpointCoordinator.ss: DataTransferComplete()
CheckpointCoordinator.ss->MetaData.ss: NotifyCheckpointComplete()
CheckpointCoordinator.ss->Hooks.ss: NotifyCheckpointComplete()
Hooks.ss-->Channel.ss: CompleteCheckpoint()
Channel.ss-->CheckpointCoordinator.ss: ConfirmCheckpointCompletion()

JobMaster.ss->CheckpointCoordinator.ss: TriggerCheckpoint()
CheckpointCoordinator.ss->JobGraph.ss: DefineJobStructure()
JobGraph.ss->ExecutionGraph.ss: InitializeExecutionGraph()
ExecutionGraph.ss->CheckpointCoordinator.ss: RegisterExecutionGraph()
CheckpointCoordinator.ss->TaskExecutor.ss: ExecuteCheckpoint()
TaskExecutor.ss->TaskManager.ss: NotifyCheckpoint()
TaskManager.ss->State.ss: CaptureState()
State.ss->Channel.ss: StartStateDataTransfer()
Channel.ss->CheckpointCoordinator.ss: DataTransferComplete()
CheckpointCoordinator.ss->State.ss: NotifyCheckpointComplete()
TaskManager.ss->State.ss: RestoreState()
State.ss->CheckpointCoordinator.ss: StateRestorationConfirmation()
CheckpointCoordinator.ss->Hooks.ss: NotifyCheckpointComplete()
Hooks.ss->Channel.ss: CompleteCheckpoint()
Channel.ss->CheckpointCoordinator.ss: ConfirmCheckpointCompletion()

@enduml